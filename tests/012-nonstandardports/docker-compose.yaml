version: '3'

networks:
  ectest:
    driver: bridge
    #enable_ipv6: false
    ipam:
      driver: default
      config:
        - subnet: ${TESTNET:-172.27.0}.0/24

services:
  controller001:
    command:
      - /etcd-controller
    environment:
      ETCDCONTROLLER_IP: ${TESTNET:-172.27.0}.101
      ETCDCONTROLLER_COMMAND_PORT: "${COMMAND_PORT:-4270}"
      ETCDCONTROLLER_SERF_PORT: "${SERF_PORT:-4271}"
      ETCDCONTROLLER_NAME: ${TESTNAME:-test}-101
      ETCDCONTROLLER_CLIENT_PORT: "${CLIENT_PORT:-2379}"
      ETCDCONTROLLER_PEER_PORT: "${PEER_PORT:-2380}"
    image: "etcd-controller:snapshot"
    networks:
      ectest:
        ipv4_address: ${TESTNET:-172.27.0}.101
    volumes:
      - "./config:/config"
  controller002:
    command:
      - /etcd-controller
    environment:
      ETCDCONTROLLER_IP: ${TESTNET:-172.27.0}.102
      ETCDCONTROLLER_COMMAND_PORT: "${COMMAND_PORT:-4270}"
      ETCDCONTROLLER_SERF_PORT: "${SERF_PORT:-4271}"
      ETCDCONTROLLER_NAME: ${TESTNAME:-test}-102
      ETCDCONTROLLER_CLIENT_PORT: "${CLIENT_PORT:-2379}"
      ETCDCONTROLLER_PEER_PORT: "${PEER_PORT:-2380}"
    image: "etcd-controller:snapshot"
    networks:
      ectest:
        ipv4_address: ${TESTNET:-172.27.0}.102
    volumes:
      - "./config:/config"
  controller003:
    command:
      - /etcd-controller
    environment:
      ETCDCONTROLLER_IP: ${TESTNET:-172.27.0}.103
      ETCDCONTROLLER_COMMAND_PORT: "${COMMAND_PORT:-4270}"
      ETCDCONTROLLER_SERF_PORT: "${SERF_PORT:-4271}"
      ETCDCONTROLLER_NAME: ${TESTNAME:-test}-103
      ETCDCONTROLLER_CLIENT_PORT: "${CLIENT_PORT:-2379}"
      ETCDCONTROLLER_PEER_PORT: "${PEER_PORT:-2380}"
    image: "etcd-controller:snapshot"
    networks:
      ectest:
        ipv4_address: ${TESTNET:-172.27.0}.103
    volumes:
      - "./config:/config"
  ctl:
    image: "etcd-controller:snapshot"
    environment:
      ETCDCTL_API: "3"
    networks:
      ectest:
        ipv4_address: ${TESTNET:-172.27.0}.10
    command:
      - /bin/sleep
      - "3600"

